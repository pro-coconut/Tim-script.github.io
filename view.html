<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ScriptBlox Mini ‚Äî View</title>
<style>
  body{margin:0;font-family:Inter,Arial;background:#0b1220;color:#e6eef8;padding:18px}
  .back{color:#38bdf8;cursor:pointer;margin-bottom:12px;display:inline-block}
  h1{margin:8px 0}
  .meta{color:#94a3b8;margin-bottom:10px}
  .code{background:#071827;padding:12px;border-radius:10px;overflow:auto;max-height:60vh;white-space:pre-wrap;font-family:monospace}
  .btn{background:#22c55e;border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
  a.link{margin-left:10px;color:#94a3b8;text-decoration:none;background:#0b1620;padding:6px 8px;border-radius:8px}
</style>
</head>
<body>

<div class="back" onclick="history.back()">‚Üê Quay l·∫°i</div>

<h1 id="title">ƒêang t·∫£i...</h1>
<div id="info" class="meta"></div>

<div id="code" class="code">...</div>

<div style="margin-top:10px">
  <button id="btnCopy" class="btn">Copy Script</button>
  <a id="openOnScriptBlox" class="link" target="_blank" rel="noopener">M·ªü tr√™n ScriptBlox</a>
</div>

<script>
const API_BASE = 'https://scriptblox.com/api';
const params = new URLSearchParams(window.location.search);
const id = params.get('id');

const titleEl = document.getElementById('title');
const infoEl = document.getElementById('info');
const codeEl = document.getElementById('code');
const btnCopy = document.getElementById('btnCopy');
const openLink = document.getElementById('openOnScriptBlox');

async function loadScript(){
  if(!id){ titleEl.innerText = 'ID kh√¥ng h·ª£p l·ªá'; codeEl.innerText = ''; return; }
  titleEl.innerText = 'ƒêang t·∫£i...';
  try{
    const res = await fetch(`${API_BASE}/script/${id}`);
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const j = await res.json();
    const s = j.script || j.result || {};
    titleEl.innerText = s.title || '‚Äî';
    infoEl.innerText = `Game: ${s.game?.name || '-'} ¬∑ T√°c gi·∫£: ${s.owner?.username || '-'} ¬∑ üëÅ ${s.views || 0}`;
    codeEl.innerText = s.script || '[Kh√¥ng c√≥ script]';
    openLink.href = `https://scriptblox.com/script/${s.slug || s._id || id}`;
    btnCopy.onclick = ()=>{ navigator.clipboard.writeText(s.script || '').then(()=>alert('ƒê√£ copy!')).catch(()=>alert('Copy th·∫•t b·∫°i')); };
  }catch(e){
    console.error(e);
    titleEl.innerText = 'L·ªói t·∫£i script';
    codeEl.innerText = e.message || 'L·ªói';
    infoEl.innerText = '';
  }
}

loadScript();

// register service worker (for caching)
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{/* ignore */});
}
</script>

</body>
</html>
